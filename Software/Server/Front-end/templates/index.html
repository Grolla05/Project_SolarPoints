{% extends "layout.html" %}
{% block body %}

<!-- Hero Section with Map -->
<div class="mb-12">
  <div class="text-center mb-8">
    <div class="inline-flex items-center space-x-3 mb-4">
      <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-green-500 rounded-full flex items-center justify-center animate-pulse">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"/>
        </svg>
      </div>
      <h2 class="text-3xl font-bold text-white">Localizações dos Dispositivos</h2>
    </div>
    <p class="text-white/70 text-lg max-w-2xl mx-auto">
      Acompanhe em tempo real a localização e status de todos os dispositivos Solar Points instalados
    </p>
  </div>

  <!-- Map Container with Modern Styling -->
  <div class="relative group">
    <div class="absolute inset-0 bg-gradient-to-r from-blue-500/20 to-green-500/20 rounded-2xl blur-lg group-hover:blur-xl transition-all duration-300"></div>
    <div class="relative bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl overflow-hidden shadow-2xl">
      <div class="bg-gradient-to-r from-blue-600 to-green-600 p-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
              <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <span class="text-white font-semibold">Mapa Interativo</span>
          </div>
          <div class="flex items-center space-x-2">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <span class="text-white/80 text-sm">Online</span>
          </div>
        </div>
      </div>
      <div id="map" class="h-96"></div>
    </div>
  </div>
</div>

<!-- Map Scripts (mantendo funcionalidade original) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha2d-R-W7FgeBfS6UjP4tF5s6Fv6X6B6p/4pQ4s5M+7Gj6p/6f5B+g=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha2d-R-W7FgeBfS6UjP4tF5s6Fv6X6B6p/4pQ4s5M+7Gj6p/6f5B+g=" crossorigin=""></script>
<script src="{{ url_for('static', filename='Maps_API.js') }}"></script>
<script>
    // Aqui o Flask processa o Jinja2 e a variável locations é criada
    const locations = {{ items | tojson }};

    console.log("Dados que chegaram ao front-end para o mapa:", locations);
    
    // Chamamos a função do arquivo externo, passando os dados
    loadMap(locations);
</script>

<!-- Technical Documentation Section -->
<div class="space-y-8">
  <!-- Main Title -->
  <div class="text-center mb-12">
    <div class="inline-flex items-center space-x-3 mb-4">
      <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
        </svg>
      </div>
      <h1 class="text-4xl font-bold text-gradient">O Sistema IoT: Do Hardware ao Banco de Dados</h1>
    </div>
    <p class="text-white/80 text-lg max-w-4xl mx-auto">
      O sistema que você construiu é uma solução completa de IoT (Internet das Coisas) que opera em uma sequência lógica, 
      conectando hardware, software e persistência de dados.
    </p>
  </div>

  <!-- System Architecture Cards -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    
    <!-- Card 1: Hardware Layer -->
    <div class="glass-effect rounded-3xl p-8 hover:scale-105 transition-all duration-300 group border border-white/10">
      <div class="flex items-center space-x-4 mb-6">
        <div class="w-14 h-14 bg-gradient-to-r from-orange-500 to-red-500 rounded-2xl flex items-center justify-center group-hover:rotate-6 transition-transform duration-300">
          <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
          </svg>
        </div>
        <div>
          <h2 class="text-2xl font-bold text-white mb-1">1. A Camada de Hardware</h2>
          <p class="text-orange-400 font-medium">(O ESP32)</p>
        </div>
      </div>
      <p class="text-white/80 mb-6">
        O <strong class="text-orange-400">ESP32</strong> é o "cérebro" do sistema e a fonte dos dados. 
        Ele é o microcontrolador responsável por:
      </p>
      <div class="space-y-4">
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Coletar Dados:</strong>
            <span class="text-white/70"> Através de um sensor de GPS conectado, ele obtém as coordenadas geográficas precisas de </span>
            <strong class="text-blue-400">latitude</strong> <span class="text-white/70">e</span> <strong class="text-blue-400">longitude</strong><span class="text-white/70">.</span>
          </div>
        </div>
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Gerar Dados:</strong>
            <span class="text-white/70"> Ele gera ou lê o valor do </span>
            <strong class="text-purple-400">Dado1</strong><span class="text-white/70">, que é um número inteiro.</span>
          </div>
        </div>
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Formatar o Envio:</strong>
            <span class="text-white/70"> Ele empacota todas essas informações (Dado1, latitude, longitude) em um objeto </span>
            <strong class="text-yellow-400">JSON</strong><span class="text-white/70">, que é o formato padrão para comunicação via web.</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Card 2: Communication Layer -->
    <div class="glass-effect rounded-3xl p-8 hover:scale-105 transition-all duration-300 group border border-white/10">
      <div class="flex items-center space-x-4 mb-6">
        <div class="w-14 h-14 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center group-hover:rotate-6 transition-transform duration-300">
          <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
          </svg>
        </div>
        <div>
          <h2 class="text-2xl font-bold text-white mb-1">2. A Camada de Comunicação</h2>
          <p class="text-cyan-400 font-medium">(A API)</p>
        </div>
      </div>
      <p class="text-white/80 mb-6">
        A comunicação entre o hardware e o software é feita via <strong class="text-cyan-400">Wi-Fi</strong> 
        usando o protocolo <strong class="text-cyan-400">HTTP</strong>.
      </p>
      <div class="space-y-4">
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Requisição HTTP POST:</strong>
            <span class="text-white/70"> O ESP32 atua como um "cliente" que faz uma requisição do tipo </span>
            <strong class="text-green-400">POST</strong> <span class="text-white/70">para o seu servidor.</span>
          </div>
        </div>
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Rota da API:</strong>
            <span class="text-white/70"> O endereço de destino para o envio de dados é a rota específica que você definiu no seu servidor: </span>
            <code class="bg-gray-800/50 text-yellow-400 px-2 py-1 rounded text-sm">http://&lt;seu_ip&gt;:3000/Back-end</code>
          </div>
        </div>
      </div>
    </div>

    <!-- Card 3: Software Layer -->
    <div class="glass-effect rounded-3xl p-8 hover:scale-105 transition-all duration-300 group border border-white/10">
      <div class="flex items-center space-x-4 mb-6">
        <div class="w-14 h-14 bg-gradient-to-r from-green-500 to-emerald-500 rounded-2xl flex items-center justify-center group-hover:rotate-6 transition-transform duration-300">
          <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z"/>
          </svg>
        </div>
        <div>
          <h2 class="text-2xl font-bold text-white mb-1">3. A Camada de Software</h2>
          <p class="text-emerald-400 font-medium">(O Servidor Python/Flask)</p>
        </div>
      </div>
      <p class="text-white/80 mb-6">
        O seu código Python com <strong class="text-emerald-400">Flask</strong> é o "servidor" que 
        fica aguardando as requisições do ESP32.
      </p>
      <div class="space-y-4">
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Recebimento:</strong>
            <span class="text-white/70"> Quando uma requisição POST chega na rota </span>
            <code class="bg-gray-800/50 text-cyan-400 px-2 py-1 rounded text-sm">/Back-end</code>
            <span class="text-white/70">, a função </span>
            <code class="bg-gray-800/50 text-emerald-400 px-2 py-1 rounded text-sm">receber_dados()</code>
            <span class="text-white/70"> é ativada.</span>
          </div>
        </div>
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Processamento:</strong>
            <span class="text-white/70"> O servidor lê o corpo da requisição e extrai os dados do JSON. Ele valida se as chaves (Dado1, localizacao, etc.) e os tipos de dados estão corretos.</span>
          </div>
        </div>
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Persistência:</strong>
            <span class="text-white/70"> Após o processamento, o servidor chama a função </span>
            <code class="bg-gray-800/50 text-purple-400 px-2 py-1 rounded text-sm">salvar_dados()</code>
            <span class="text-white/70"> para armazenar as informações de forma permanente.</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Card 4: Database Layer -->
    <div class="glass-effect rounded-3xl p-8 hover:scale-105 transition-all duration-300 group border border-white/10">
      <div class="flex items-center space-x-4 mb-6">
        <div class="w-14 h-14 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center group-hover:rotate-6 transition-transform duration-300">
          <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
          </svg>
        </div>
        <div>
          <h2 class="text-2xl font-bold text-white mb-1">4. A Camada de Persistência</h2>
          <p class="text-pink-400 font-medium">(O Banco de Dados em nuvem (PostgreSQL))</p>
        </div>
      </div>
      <p class="text-white/80 mb-6">
        O <strong class="text-pink-400">PostgreSQL</strong> é a camada final, responsável por guardar
        o histórico de todos os dados recebidos.
      </p>
      <div class="space-y-4">
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Arquivo neon.db:</strong>
            <span class="text-white/70"> O arquivo neon.db foi armazenado em nuvem através da Neon (PostgreSQL).</span>
            <span class="text-white/70"> No qual se baseia em um serviço gratuito de banco de dados em nuvem.</span>
          </div>
        </div>
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Tabela dados_esp32:</strong>
            <span class="text-white/70"> A função </span>
            <code class="bg-gray-800/50 text-blue-400 px-2 py-1 rounded text-sm">setup_database()</code>
            <span class="text-white/70"> garante que uma tabela chamada </span>
            <code class="bg-gray-800/50 text-pink-400 px-2 py-1 rounded text-sm">dados_esp32</code>
            <span class="text-white/70"> seja criada, com colunas prontas para receber cada valor do JSON (incluindo o </span>
            <code class="bg-gray-800/50 text-green-400 px-2 py-1 rounded text-sm">timestamp</code>
            <span class="text-white/70"> para saber quando cada dado chegou).</span>
          </div>
        </div>
        <div class="flex items-start space-x-3">
          <div class="w-6 h-6 bg-green-500/20 rounded-full flex items-center justify-center mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7-293a1 1 0 011.414 0z"/>
            </svg>
          </div>
          <div>
            <strong class="text-white">Registro:</strong>
            <span class="text-white/70"> A cada novo envio do ESP32, uma nova linha é inserida nessa tabela, criando um registro completo e persistente de todas as informações.</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary Section -->
  <div class="mt-12">
    <div class="glass-effect rounded-3xl p-8 border border-white/10 text-center">
      <div class="inline-flex items-center space-x-3 mb-6">
        <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-gradient">Em resumo</h3>
      </div>
      <div class="max-w-4xl mx-auto text-white/80 text-lg leading-relaxed">
        <p class="mb-4">
          O <strong class="text-orange-400">ESP32</strong> coleta os dados, os empacota em um 
          <strong class="text-yellow-400">JSON</strong>, e os envia via <strong class="text-cyan-400">Wi-Fi</strong>. 
          O servidor <strong class="text-emerald-400">Flask</strong> recebe e processa o 
          <strong class="text-yellow-400">JSON</strong>, e então salva os dados em uma tabela no banco de dados 
          <strong class="text-pink-400">SQLite</strong>, garantindo que as informações fiquem armazenadas de forma 
          segura e organizada para que possam ser exibidas neste servidor WEB no qual pode-se consultar pela internet normalmente.
        </p>
        <p class="text-solar-yellow font-medium">
          Assim mostrando a quantidade de pessoas que passam diariamente em um local específico no qual o ESP32 está localizado.
        </p>
      </div>
    </div>
  </div>
</div>

{% endblock %}